---
title: NH
description: ""
date: 2025-09-24T11:54:56.051Z
preview: ""
tags:
  - nixos
categories: []
layout: post
subtitle: Une meilleure interface pour nixos-rebuild et home-manager
author: Damien
comments: false
mathjax: false
draft: false
---

J'utilise NixOS au quotidien et je trouve les sorties des commandes nixos-rebuild et home-manager très bavarde pour finalement avoir du mal à visualiser quels paquets sont ajoutés et ceux qui sont supprimés.

Une solution est nh (Nix Helper).  
En plus de raccourcir les commandes, il affiche les sorties efficacement.  
Il permet également de rechercher rapidement un paquet.

# Commandes

#### Quelques équivalences de commandes utiles au quotidien

```nix
# Home-manager
home-manager switch --flake .#damien@desktop
nh home switch -c damien@desktop

nix flake update + home-manager switch --flake .#damien@desktop
nh home switch -u -c damien@desktop

# Nixos
sudo nixos-rebuild switch --flake .#desktop
nh os switch -H desktop
# ne pas lancer nh en sudo, il demandera le mot de passe
```
Exemple de retour avec nh

```nix
┏━ Dependency Graph:
┃    ┌─ ✔ etc-nix-registry.json
┃    │  ┌─ ✔ unit-dbus.service
┃    ├─ ✔ user-units
┃    │  ┌─ ✔ unit-accounts-daemon.service
┃    │  │  ┌─ ✔ X-Restart-Triggers-polkit
┃    │  ├─ ✔ unit-polkit.service
┃    │  │              ┌─ ↓ ✔ nix-2.24.15
┃    │  │           ┌─ ↓ ✔ nix-du-1.2.3
┃    │  │        ┌─ ✔ system-path ⏱ 5s
┃    │  │     ┌─ ✔ dbus-1
┃    │  │  ┌─ ✔ X-Restart-Triggers-dbus
┃    │  ├─ ✔ unit-dbus.service
┃    ├─ ✔ system-units ⏱ 2s
┃ ┌─ ✔ etc ⏱ 1s
┃ ✔ nixos-system-desktop-25.05.20250923.d1d8831
┣━━━ Builds           │ Downloads       │ Host
┃        │ ✔ 13 │     │     │     │     │ localhost
┃        │      │     │     │ ↓ 3 │     │ https://cache.nixos.org
┗━ ∑ ⏵ 0 │ ✔ 13 │ ⏸ 0 │ ↓ 0 │ ↓ 3 │ ⏸ 0 │ Finished at 14:07:03 after 45s
> Comparing changes
<<< /run/current-system
>>> /tmp/nh-osrwaYBW/result
Version changes:
[C*]  #1  nix  2.28.5, 2.28.5-doc, 2.28.5-man -> 2.24.15, 2.24.15-man, 2.28.5, 2.28.5-doc, 2.28.5-man
Added packages:
[A+]  #1  nix-du  1.2.3
Closure size: 1758 -> 1761 (17 paths added, 14 paths removed, delta +3, disk usage +19.2MiB).
> Activating configuration
```

#### Rechercher un paquet dans le terminal

```nix
nh search --limit 3 foot

footswitch (2023-10-10)
  Command line utlities for programming PCsensor and Scythe foot switches
  Homepage: https://github.com/rgerganov/footswitch
  Defined at: pkgs/by-name/fo/footswitch/package.nix

footage (1.3.2)
  Video editing tool that allows you to trim, flip, rotate, and crop clips
  Homepage: https://gitlab.com/adhami3310/Footage
  Defined at: pkgs/by-name/fo/footage/package.nix

foot (1.23.1)
  Fast, lightweight and minimalistic Wayland terminal emulator
  Homepage: https://codeberg.org/dnkl/foot/
  Defined at: pkgs/by-name/fo/foot/package.nix
```

#### Faire le ménage des paquets non utilisés

```nix
nh clean all -k 3 --ask

Welcome to nh clean
Keeping 3 generation(s)
Keeping paths newer than 0s

legend:
OK: path to be kept
DEL: path to be removed

/nix/var/nix/profiles/system
- OK  /nix/var/nix/profiles/system-246-link
- OK  /nix/var/nix/profiles/system-245-link
- OK  /nix/var/nix/profiles/system-244-link
- DEL /nix/var/nix/profiles/system-243-link
- DEL /nix/var/nix/profiles/system-242-link
- DEL /nix/var/nix/profiles/system-241-link


/home/damien/.local/state/nix/profiles/home-manager
- OK  /home/damien/.local/state/nix/profiles/home-manager-86-link
- OK  /home/damien/.local/state/nix/profiles/home-manager-85-link
- OK  /home/damien/.local/state/nix/profiles/home-manager-84-link
- DEL /home/damien/.local/state/nix/profiles/home-manager-83-link
- DEL /home/damien/.local/state/nix/profiles/home-manager-82-link
- DEL /home/damien/.local/state/nix/profiles/home-manager-81-link


/home/damien/.local/state/nix/profiles/profile
- OK  /home/damien/.local/state/nix/profiles/profile-64-link
- OK  /home/damien/.local/state/nix/profiles/profile-63-link
- OK  /home/damien/.local/state/nix/profiles/profile-62-link
- DEL /home/damien/.local/state/nix/profiles/profile-61-link
- DEL /home/damien/.local/state/nix/profiles/profile-60-link
- DEL /home/damien/.local/state/nix/profiles/profile-59-link

> Confirm the cleanup plan?
[y/N]
```



# Ressources

[NH github](https://github.com/nix-community/nh)

